---
description: 
globs: 
alwaysApply: true
---
# Timeline Scrolling Logic

The horizontal timeline at the bottom is a `<scroll-view>` implemented in `[pages/index/index.wxml](mdc:pages/index/index.wxml)`. Its scrolling behavior and the red indicator's position are controlled by `[pages/index/index.js](mdc:pages/index/index.js)`.

- **Timeline Labels**: Static labels representing major periods/dynasties (e.g., "夏", "商", "周", "春秋"..., "清", "现代") are displayed along the timeline background. These are defined in `timelineShortLabels` in `[pages/index/index.js](mdc:pages/index/index.js)`. Note: "早期" is intentionally omitted from these static labels.
- **Scrolling & Indicator Trigger**: Scrolling and indicator positioning happen when a period button is clicked (`onPeriodTap`) or when the timeline background is tapped (`onRulerContentTap`).
- **Target Position Calculation & Behavior**:
    - **"早期" Period**: When the "早期" button is clicked, the timeline scrolls to the far left (`scrollLeft: 0`), and the red indicator is hidden (`currentRulerPosition: null`).
    - **Other Periods (Xia onwards)**: For all other periods, the `calculateAndSetPosition` function is called. This function uses the standard dynasty start years from `dynastyStartYearsMap` to calculate the precise percentage position (`currentRulerPosition`) of the red indicator based on its temporal location between the start of the Xia dynasty and the defined end year for the '现代' period.
    - **Centering**: The `scrollToCenter` function then calculates the required `scroll-left` value for the `<scroll-view>` to position the calculated red indicator percentage (`currentRulerPosition`) in the horizontal center of the visible scroll view area.
- **Indicator vs. Labels**: Because the red indicator's position is calculated based on strict *time* proportions (from Xia onwards), it may not always align perfectly with the *static visual labels* on the timeline background, which might be spaced differently for readability or grouping.



