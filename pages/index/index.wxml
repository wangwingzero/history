<!--index.wxml-->
<wxs module="formatter">
  // å°†æ–‡æœ¬ä¸­çš„é«˜äº®æ ‡è®°è½¬æ¢ä¸ºå¯æ¸²æŸ“çš„æ•°ç»„
  function parseHighlightedText(text) {
    if (!text) return [{ text: '', highlight: false }];
    
    var parts = text.split('{%%HIGHLIGHT%%}');
    var result = [];
    
    for (var i = 0; i < parts.length; i++) {
      if (i === 0) {
        // ç¬¬ä¸€éƒ¨åˆ†ä¸æ˜¯é«˜äº®çš„
        if (parts[i]) {
          result.push({ text: parts[i], highlight: false });
        }
      } else {
        // å…¶ä»–éƒ¨åˆ†éœ€è¦è¿›ä¸€æ­¥åˆ†å‰²ï¼Œæ‰¾åˆ°é«˜äº®æ–‡æœ¬çš„ç»“æŸä½ç½®
        var subParts = parts[i].split('{%%/HIGHLIGHT%%}');
        if (subParts.length > 0) {
          // é«˜äº®éƒ¨åˆ†
          if (subParts[0]) {
            result.push({ text: subParts[0], highlight: true });
          }
          // éé«˜äº®éƒ¨åˆ†
          if (subParts.length > 1 && subParts[1]) {
            result.push({ text: subParts[1], highlight: false });
          }
        }
      }
    }
    
    return result;
  }
  
  module.exports = {
    parseHighlightedText: parseHighlightedText
  };
</wxs>

<view class="container">
  <!-- æ–°å¢ä¸»å†…å®¹å®¹å™¨ -->
  <view class="page-content">
    <!-- åœ°å›¾åŒºåŸŸ -->
    <map
      id="map"
      class="map-component"
      longitude="{{longitude}}"
      latitude="{{latitude}}"
      scale="{{scale}}"
      min-scale="3"
      max-scale="20"
      markers="{{markers}}"
      polygons="{{dynastyPolygons}}"
      circles="{{circles}}"
      bindmarkertap="onMarkerTap"
      bindlabeltap="onMarkerTap"
      style="width: 100%;"
      catchtap="onMapTap"
      bindregionchange="onRegionChange"
      enable-rotate
      enable-overlooking
      enable-traffic
      enable-poi
      enable-building
      show-location="{{false}}"
    >
      <!-- æ–°å¢ï¼šä¸€é”®é‡ç½®åœ°å›¾è§†è§’æŒ‰é’® (æŒ‡åŒ—é’ˆ) -->
      <!-- <view class="reset-map-button" bindtap="resetMapView">
        <image class="reset-map-icon" src="/images/compass_icon.png" style="transform: rotate({{mapRotation}}deg);" />
      </view> -->

      <!-- ä¿®æ”¹ï¼šå°†å¼¹çª—ç§»å…¥å®¹å™¨ -->
      <!-- <view class="custom-callout {{chineseCalloutIsSecondary ? 'popup-secondary' : ''}}" wx:if="{{selectedMarkerInfo}}"> ... </view> -->
    </map>

    <!-- æ–°å¢ï¼šå¼¹çª—å®¹å™¨ -->
    <view class="popup-container">
      <!-- ä¸–ç•Œå†å²äº‹ä»¶ä¼˜å…ˆï¼ˆå½“ domestic is secondaryï¼‰ -->
      <view class="custom-callout" 
            wx:if="{{selectedWorldEventDetail && chineseCalloutIsSecondary}}"
            bindtap="onCalloutTap" data-type="world" data-lat="{{selectedWorldEventDetail.latitude}}" data-lng="{{selectedWorldEventDetail.longitude}}">
         <view class="callout-close-btn" catchtap="onCloseWorldEventDetailPopup">å…³é—­</view>
         <view class="callout-title world-event-title-orange"><text wx:if="{{selectedWorldEventDetail.mapLabel}}" class="callout-marker-label world-event-marker-label">[{{selectedWorldEventDetail.mapLabel}}]</text> {{selectedWorldEventDetail.title}}</view>
         <view class="callout-time">
           {{selectedWorldEventDetail.startYearDisplay}}
           <block wx:if="{{selectedWorldEventDetail.endYearDisplay && selectedWorldEventDetail.endYearDisplay !== selectedWorldEventDetail.startYearDisplay}}">
             - {{selectedWorldEventDetail.endYearDisplay}}
           </block>
         </view>
         <view class="callout-location" wx:if="{{selectedWorldEventDetail.locationName}}">
           <text class="location-icon">ğŸ“</text> {{selectedWorldEventDetail.locationName}}
         </view>
         <view class="callout-details">{{selectedWorldEventDetail.description || selectedWorldEventDetail.details}}</view>
      </view>
      <!-- å›½å†…äº‹ä»¶ä¼˜å…ˆï¼ˆå½“ world is secondary or world not visibleï¼‰ -->
      <view class="custom-callout" 
            wx:if="{{selectedMarkerInfo && (!selectedWorldEventDetail || worldPopupIsSecondary)}}" 
            bindtap="onCalloutTap" data-type="china" data-lat="{{selectedMarkerInfo.latitude}}" data-lng="{{selectedMarkerInfo.longitude}}">
         <view class="callout-close-btn" catchtap="onCloseChineseCallout">å…³é—­</view>
         <view class="callout-title chinese-event-title-blue"><text wx:if="{{selectedMarkerInfo.mapLabel}}" class="callout-marker-label">[{{selectedMarkerInfo.mapLabel}}]</text> {{selectedMarkerInfo.title}}</view>
         <view class="callout-time">
           {{selectedMarkerInfo.startYearDisplay}}
           <block wx:if="{{selectedMarkerInfo.endYearDisplay && selectedMarkerInfo.endYearDisplay !== selectedMarkerInfo.startYearDisplay}}">
             - {{selectedMarkerInfo.endYearDisplay}}
           </block>
         </view>
         <view class="callout-location" wx:if="{{selectedMarkerInfo.locationName}}">
           <text class="location-icon">ğŸ“</text> {{selectedMarkerInfo.locationName}}
         </view>
         <view class="callout-details">{{selectedMarkerInfo.details}}</view>
      </view>
      <!-- ä¸–ç•Œå†å²äº‹ä»¶åæ¸²æŸ“ï¼ˆå½“ domestic is primary and world is visibleï¼‰ -->
      <view class="custom-callout" 
            wx:if="{{selectedWorldEventDetail && !chineseCalloutIsSecondary}}"
            bindtap="onCalloutTap" data-type="world" data-lat="{{selectedWorldEventDetail.latitude}}" data-lng="{{selectedWorldEventDetail.longitude}}">
         <view class="callout-close-btn" catchtap="onCloseWorldEventDetailPopup">å…³é—­</view>
         <view class="callout-title world-event-title-orange"><text wx:if="{{selectedWorldEventDetail.mapLabel}}" class="callout-marker-label world-event-marker-label">[{{selectedWorldEventDetail.mapLabel}}]</text> {{selectedWorldEventDetail.title}}</view>
         <view class="callout-time">
           {{selectedWorldEventDetail.startYearDisplay}}
           <block wx:if="{{selectedWorldEventDetail.endYearDisplay && selectedWorldEventDetail.endYearDisplay !== selectedWorldEventDetail.startYearDisplay}}">
             - {{selectedWorldEventDetail.endYearDisplay}}
           </block>
         </view>
         <view class="callout-location" wx:if="{{selectedWorldEventDetail.locationName}}">
           <text class="location-icon">ğŸ“</text> {{selectedWorldEventDetail.locationName}}
         </view>
         <view class="callout-details">{{selectedWorldEventDetail.description || selectedWorldEventDetail.details}}</view>
      </view>
      <!-- å›½å†…äº‹ä»¶åæ¸²æŸ“ï¼ˆå½“ world is primary and domestic is visibleï¼‰ -->
      <view class="custom-callout" 
            wx:if="{{selectedMarkerInfo && selectedWorldEventDetail && !worldPopupIsSecondary}}"
            bindtap="onCalloutTap" data-type="china" data-lat="{{selectedMarkerInfo.latitude}}" data-lng="{{selectedMarkerInfo.longitude}}">
         <view class="callout-close-btn" catchtap="onCloseChineseCallout">å…³é—­</view>
          <view class="callout-title chinese-event-title-blue"><text wx:if="{{selectedMarkerInfo.mapLabel}}" class="callout-marker-label">[{{selectedMarkerInfo.mapLabel}}]</text> {{selectedMarkerInfo.title}}</view>
         <view class="callout-time">
           {{selectedMarkerInfo.startYearDisplay}}
           <block wx:if="{{selectedMarkerInfo.endYearDisplay && selectedMarkerInfo.endYearDisplay !== selectedMarkerInfo.startYearDisplay}}">
             - {{selectedMarkerInfo.endYearDisplay}}
           </block>
         </view>
         <view class="callout-location" wx:if="{{selectedMarkerInfo.locationName}}">
           <text class="location-icon">ğŸ“</text> {{selectedMarkerInfo.locationName}}
         </view>
         <view class="callout-details">{{selectedMarkerInfo.details}}</view>
      </view>
    </view>

    <!-- åº•éƒ¨æ§ä»¶å®¹å™¨ -->
    <view class="bottom-controls">

      <!-- ä¿®æ”¹ï¼šå°†æŒ‰é’®æ”¹ä¸ºä¸‰ä¸ªæŒ‰é’®ï¼Œå¹¶è°ƒæ•´ä¸º"ä¸­å›½å² æœç´¢ ä¸–ç•Œå²"çš„æ’åˆ— -->
      <view class="world-history-trigger-container">
        <button class="history-button chinese-history-button" bindtap="onToggleChineseHistoryPanel">
          ç‚¹å‡»â¡ï¸ä¸­å›½å²ğŸ“– 
        </button>
        <button class="history-button search-button" bindtap="onToggleSearchPanel">
          ç‚¹å‡»â¡ï¸æœç´¢ğŸ”
        </button>
        <button class="history-button world-history-button" bindtap="onToggleWorldHistoryPanel">
          ç‚¹å‡»â¡ï¸ä¸–ç•Œå²ğŸ“–
        </button>
      </view>

      <!-- ==================== è°ƒæ•´åï¼šå­æ—¶é—´è½´ (ç¬¬ä¸€ä½) ==================== -->
      <view class="sub-timeline-container" wx:if="{{showSubTimeline}}">
        <view class="sub-timeline-labels">
          <text class="sub-timeline-label-start">{{subTimelineStartLabel}}</text>
          <text class="sub-timeline-label-end">{{subTimelineEndLabel}}</text>
        </view>
        <view class="sub-timeline-bar">
          <view class="sub-timeline-indicator" 
                wx:if="{{selectedEventStartYearPosition !== null && selectedEventDurationWidth !== null}}" 
                style="left: {{selectedEventStartYearPosition}}%; width: {{selectedEventDurationWidth}}%;"></view>
          <!-- ä¿®æ”¹ï¼šä¸–ç•Œäº‹ä»¶æŒ‡ç¤ºå™¨ç»‘å®š left å’Œ widthï¼Œå¹¶æ·»åŠ åŠ¨æ€é‡å ç±» -->
          <view class="sub-timeline-indicator world-event-indicator {{subTimelineWorldEventIsOverlap ? 'sub-indicator-overlap' : ''}}"
                wx:if="{{worldEventOnSubTimelinePosition !== null}}" 
                style="left: {{worldEventOnSubTimelinePosition}}%; width: {{worldEventOnSubTimelineDurationWidth}}%; background-color: #FF8C00;"> </view>
        </view>
      </view>
      <!-- ==================== ç»“æŸå­æ—¶é—´è½´ ==================== -->

      <!-- é™æ€å†å²æ ‡å°ºåŒºåŸŸ (ä¸»æ—¶é—´è½´) (ç¬¬äºŒä½) -->
      <view class="static-history-ruler-container">
        <view class="static-ruler-line"></view>
        <!-- ä¿®æ”¹ï¼šéå† numericalLabels å¹¶ä½¿ç”¨ç»å¯¹å®šä½ -->
        <view class="static-ruler-labels">
            <text 
              wx:for="{{numericalLabels}}" 
              wx:key="year" 
              class="static-ruler-label-item" 
              style="left: {{item.position}}%;"> 
              {{item.label}}
            </text>
        </view>
        <!-- çº¢è‰²æŒ‡ç¤ºå™¨ (æ—¶æœŸ) -->
        <view 
          wx:if="{{currentRulerPosition !== null}}"
          class="ruler-indicator" 
          style="left: {{currentRulerPosition}}%;"
        ></view>
        <!-- ä¿®æ”¹ï¼šç§»é™¤ world-event-indicator-main ç±»ï¼Œç›´æ¥ä½¿ç”¨ ruler-indicator ç±»å’Œ style -->
        <view class="ruler-indicator" 
              wx:if="{{worldEventOnMainTimelinePosition !== null}}"
              style="left: {{worldEventOnMainTimelinePosition}}%; background-color: #FF8C00; z-index: 2;"> </view>
      </view>
      <!-- END: é™æ€å†å²æ ‡å°ºåŒºåŸŸ -->

      <!-- æ—¶æœŸé€‰æ‹©å™¨ (ä¸‹æ–¹æŒ‰é’®) (ç¬¬ä¸‰ä½) -->
      <view class="timeline-container"> 
        <scroll-view class="period-buttons-scroll" scroll-x="true">
          <view class="period-buttons-content">
            <button
              wx:for="{{timePeriods}}" 
              wx:key="*this"
              class="period-button {{item === selectedPeriod ? 'active' : ''}}"
              bindtap="onPeriodTap"
              data-period="{{item}}"> 
              {{buttonLabelMap[item]}}
            </button>
          </view>
        </scroll-view>
      </view>
      <!-- END: æ—¶æœŸé€‰æ‹©å™¨ -->

    </view> <!-- End bottom-controls -->

    <!-- ç§»é™¤ç‹¬ç«‹çš„ä¸–ç•Œå†å²äº‹ä»¶è¯¦æƒ…æµ®å±‚ -->
    <!-- <view class="world-event-detail-popup {{worldPopupIsSecondary ? 'popup-secondary' : ''}}" wx:if="{{selectedWorldEventDetail}}"> ... </view> -->

  </view> <!-- End page-content -->

  <!-- æ–°å¢ï¼šä¸­å›½å†å²é¢æ¿ -->
  <view class="chinese-history-panel {{showChineseHistoryPanel ? 'panel-active' : ''}}">
    <view class="panel-header">
      <text class="panel-title">{{buttonLabelMap[selectedPeriod]}} ä¸­å›½é‡è¦äº‹ä»¶</text>
      <button class="close-panel-button" bindtap="onCloseChineseHistoryPanel">å…³é—­</button>
    </view>
    <scroll-view scroll-y="true" class="panel-content">
      <view wx:if="{{currentChineseHistoryEvents.length > 0}}">
        <view wx:for="{{currentChineseHistoryEvents}}" wx:key="id" class="chinese-event-item"
              bindtap="onChineseEventTap" data-id="{{item.id}}">
          <text class="chinese-event-title"><text class="event-map-label">[{{item.mapLabel}}]</text> {{item.title}}ğŸ‘†</text>
          <text class="chinese-event-time">ï¼ˆ{{item.startYearDisplay}}{{item.endYearDisplay && item.endYearDisplay !== item.startYearDisplay ? ' - ' + item.endYearDisplay : ''}}ï¼‰</text>
          <view class="chinese-event-location" wx:if="{{item.locationName}}">
            <text class="location-icon">ğŸ“</text> {{item.locationName}}
          </view>
          <text class="chinese-event-description">{{item.details || item.description}}</text>
        </view>
      </view>
      <view wx:else class="no-chinese-events">
        <text>æš‚æ— è¯¥æ—¶æœŸå¯¹åº”çš„ä¸­å›½å†å²è¯¦ç»†æ•°æ®ã€‚</text>
      </view>
      
      <!-- æ·»åŠ èµåŠ©è¯´æ˜å’Œå¹¿å‘Š -->
      <view class="sponsor-message">
        <view class="sponsor-title">ğŸ™ æ‚¨çš„æ”¯æŒæ˜¯ä½œè€…å‰è¿›çš„åŠ¨åŠ› ğŸ™</view>
        <text class="sponsor-text">æ„Ÿè°¢æ‚¨ä½¿ç”¨<text class="sponsor-text-highlight">è™å¤§ç‹å†å²æ—¶ç©ºå›¾</text>ï¼ä½œè€…è‡´åŠ›äºä¸ºæ‚¨æä¾›æœ€ä¼˜è´¨çš„å†å²å­¦ä¹ ä½“éªŒã€‚ä¸ºäº†èƒ½å¤Ÿ<text class="sponsor-text-highlight">æŒç»­æ›´æ–°å†å²äº‹ä»¶</text>ã€å¼€å‘æ–°åŠŸèƒ½å¹¶ç»´æŠ¤æœåŠ¡å™¨ï¼Œä½œè€…éœ€è¦æ‚¨çš„å¸®åŠ©ã€‚</text>
        <text class="sponsor-text">ç‚¹å‡»ä¸‹æ–¹å¹¿å‘Šï¼Œä¸èŠ±ä¸€åˆ†é’±å°±èƒ½æ”¯æŒä½œè€…ï¼æ‚¨çš„æ¯æ¬¡ç‚¹å‡»ï¼Œéƒ½è®©è¿™ä¸ªå°å°çš„å†å²å·¥å…·èƒ½å¤Ÿèµ°å¾—æ›´è¿œã€å¸®åŠ©æ›´å¤šäººäº†è§£å†å²ã€‚</text>
        <ad-custom unit-id="adunit-7738675e4ef88ca7" bindload="adLoad" binderror="adError" bindclose="adClose"></ad-custom>
      </view>
    </scroll-view>
  </view>

  <!-- ä¸–ç•Œå†å²é¢æ¿ -->
  <view class="world-history-panel {{showWorldHistoryPanel ? 'panel-active' : ''}}">
    <view class="panel-header">
      <text class="panel-title">{{buttonLabelMap[selectedPeriod]}} ä¸–ç•Œé‡è¦äº‹ä»¶</text>
      <button class="close-panel-button" bindtap="onCloseWorldHistoryPanel">å…³é—­</button>
    </view>
    <scroll-view scroll-y="true" class="panel-content">
      <view wx:if="{{currentWorldHistoryEvents.length > 0}}">
        <view wx:for="{{currentWorldHistoryEvents}}" wx:key="id" class="world-event-item"
              bindtap="onWorldEventTap" data-id="{{item.id}}">
          <text class="world-event-title-orange">
            <text class="world-event-map-label">[{{item.mapLabel}}]</text> {{item.title}}ğŸ‘†
          </text>
          <text class="world-event-time">ï¼ˆ{{item.startYearDisplay}}{{item.endYearDisplay ? ' - ' + item.endYearDisplay : ''}}ï¼‰</text>
          <view class="world-event-location" wx:if="{{item.locationName}}">
            <text class="location-icon">ğŸ“</text> {{item.locationName}}
          </view>
          <text class="world-event-description">{{item.details || 'æš‚æ— è¯¦ç»†æè¿°'}}</text>
        </view>
      </view>
      <view wx:else class="no-world-events">
        <text>æš‚æ— è¯¥æ—¶æœŸå¯¹åº”çš„ä¸–ç•Œå†å²æ•°æ®ã€‚</text>
      </view>
      
      <!-- æ·»åŠ ä¸–ç•Œå†å²é¢æ¿èµåŠ©è¯´æ˜å’Œå¹¿å‘Š -->
      <view class="sponsor-message">
        <view class="sponsor-title">â¤ï¸ æ‚¨çš„æ¯æ¬¡ç‚¹å‡»éƒ½æ˜¯æ”¯æŒ â¤ï¸</view>
        <text class="sponsor-text">å–œæ¬¢è¿™ä¸ªå†å²åœ°å›¾å°ç¨‹åºå—ï¼Ÿå¦‚æœå®ƒå¯¹æ‚¨å­¦ä¹ å†å²æœ‰æ‰€å¸®åŠ©ï¼Œè¯·è€ƒè™‘æ”¯æŒä½œè€…ï¼åªéœ€ç‚¹å‡»ä¸‹æ–¹å¹¿å‘Šï¼Œå°±èƒ½ä¸ºä½œè€…æä¾›åŠ¨åŠ›ï¼Œè®©ä½œè€…æ·»åŠ æ›´å¤š<text class="sponsor-text-highlight">ä¸–ç•Œå†å²äº‹ä»¶</text>å’Œ<text class="sponsor-text-highlight">æ”¹è¿›ç”¨æˆ·ä½“éªŒ</text>ã€‚</text>
        <text class="sponsor-text">æ„Ÿè°¢æ‚¨çš„ç†è§£ä¸æ”¯æŒï¼Œä½œè€…å°†ç»§ç»­åŠªåŠ›ä¸ºæ‚¨æä¾›æ›´å¥½çš„å†å²å­¦ä¹ å·¥å…·ï¼</text>
        <ad-custom unit-id="adunit-7738675e4ef88ca7" bindload="adLoad" binderror="adError" bindclose="adClose"></ad-custom>
      </view>
    </scroll-view>
    <!-- æ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼Œæ˜¾ç¤ºäº‹ä»¶æ€»æ•° -->
    <view class="debug-info">
      <text>å½“å‰å…±æœ‰ {{currentWorldHistoryEvents.length}} ä¸ªä¸–ç•Œäº‹ä»¶</text>
    </view>
  </view>

  <!-- æ–°å¢ï¼šæœç´¢é¢æ¿ -->
    <view class="search-panel {{showSearchPanel ? 'panel-active' : ''}}">
    <view class="panel-header">
      <text class="panel-title">æœç´¢å†å²äº‹ä»¶</text>
      <button class="close-panel-button" bindtap="onCloseSearchPanel">å…³é—­</button>
    </view>
    <!-- æ–°çš„ç»Ÿä¸€æœç´¢åŒºåŸŸ -->
    <view class="search-unified-container">
      <view class="search-instruction-icon">ğŸ”</view>
      <view class="search-input-wrapper">
        <input 
          class="search-input" 
          placeholder="è¾“å…¥å…³é”®å­—æœç´¢å†å²äº‹ä»¶" 
          value="{{searchKeyword}}"
          bindinput="onSearchInputChange"
          confirm-type="search"
          bindconfirm="onSearchConfirm"
          focus="{{true}}"
        />
        <button class="search-button-small" bindtap="onSearchConfirm">æœç´¢</button>
      </view>
      <view class="search-examples" wx:if="{{!hasSearched || !(searchResults.chinaEvents.length > 0 || searchResults.worldEvents.length > 0)}}">
        ä¾‹å¦‚ï¼šåˆ˜å¤‡ã€å”æœã€æ¥šæ±‰ä¹‹äº‰ã€ä¸ç»¸ä¹‹è·¯ç­‰
      </view>
    </view>
    <!-- æœç´¢ç»“æœåŒºåŸŸ -->
    <scroll-view scroll-y="true" class="panel-content">
      <view wx:if="{{searchResults.chinaEvents.length > 0 || searchResults.worldEvents.length > 0}}">
        <view class="search-result-category" wx:if="{{searchResults.chinaEvents.length > 0}}">
          <text class="search-category-title">ä¸­å›½å†å²äº‹ä»¶</text>
          <view 
            wx:for="{{searchResults.chinaEvents}}" 
            wx:key="id" 
            class="search-event-item china-event-item"
            bindtap="onSearchResultTap" 
            data-type="china" 
            data-id="{{item.id}}"
            data-period="{{item.period}}"
          >
            <view class="search-event-title">
              <block wx:for="{{formatter.parseHighlightedText(item.title)}}" wx:for-item="textPart" wx:key="index">
                <text wx:if="{{textPart.highlight}}" class="highlight-text">{{textPart.text}}</text>
                <text wx:else>{{textPart.text}}</text>
              </block>
              <text>ğŸ‘†</text>
            </view>
            <text class="search-event-time">
              ï¼ˆ{{item.startYearDisplay}}{{item.endYearDisplay ? ' - ' + item.endYearDisplay : ''}}ï¼‰ 
              <text class="search-event-period">ã€{{buttonLabelMap[item.period] || item.period}}ã€‘</text>
            </text>
            <view class="search-event-description">
              <block wx:for="{{formatter.parseHighlightedText(item.details || item.description || 'æš‚æ— è¯¦ç»†æè¿°')}}" wx:for-item="textPart" wx:key="index">
                <text wx:if="{{textPart.highlight}}" class="highlight-text">{{textPart.text}}</text>
                <text wx:else>{{textPart.text}}</text>
              </block>
            </view>
          </view>
        </view>
        <view class="search-result-category" wx:if="{{searchResults.worldEvents.length > 0}}">
          <text class="search-category-title">ä¸–ç•Œå†å²äº‹ä»¶</text>
          <view 
            wx:for="{{searchResults.worldEvents}}" 
            wx:key="id" 
            class="search-event-item world-event-item"
            bindtap="onSearchResultTap" 
            data-type="world" 
            data-id="{{item.id}}"
            data-year="{{item.startYear}}"
          >
            <view class="search-event-title world-event-title-orange">
              <block wx:for="{{formatter.parseHighlightedText(item.title)}}" wx:for-item="textPart" wx:key="index">
                <text wx:if="{{textPart.highlight}}" class="highlight-text">{{textPart.text}}</text>
                <text wx:else>{{textPart.text}}</text>
              </block>
              <text>ğŸ‘†</text>
            </view>
            <text class="search-event-time">
              ï¼ˆ{{item.startYearDisplay}}{{item.endYearDisplay ? ' - ' + item.endYearDisplay : ''}}ï¼‰
            </text>
            <view class="search-event-description">
              <block wx:for="{{formatter.parseHighlightedText(item.description || 'æš‚æ— è¯¦ç»†æè¿°')}}" wx:for-item="textPart" wx:key="index">
                <text wx:if="{{textPart.highlight}}" class="highlight-text">{{textPart.text}}</text>
                <text wx:else>{{textPart.text}}</text>
              </block>
            </view>
          </view>
        </view>
      </view>
      <view wx:elif="{{hasSearched && searchKeyword && searchKeyword.length > 0}}" class="no-search-results">
        <text>æœªæ‰¾åˆ°ä¸"{{searchKeyword}}"ç›¸å…³çš„å†å²äº‹ä»¶</text>
      </view>
      
      <!-- æ·»åŠ åº•éƒ¨èµåŠ©è¯´æ˜ - å‡çº§å¡ç‰‡å¼è®¾è®¡ -->
      <view class="sponsor-card">
        <view class="sponsor-card-icon">â¤ï¸</view>
        <view class="sponsor-title">å¸®åŠ©å®Œå–„æœç´¢åŠŸèƒ½</view>
        <text class="sponsor-text">æ„Ÿè°¢æ‚¨ä½¿ç”¨è™å¤§ç‹å†å²æ—¶ç©ºå›¾ï¼æ­£åŠªåŠ›æ”¶é›†æ›´å¤šå†å²èµ„æ–™ï¼Œæå‡æœç´¢è´¨é‡ã€‚ç‚¹å‡»ä¸‹æ–¹å¹¿å‘Šæ”¯æŒä½œè€…ï¼Œè®©è¿™ä¸ªå°ç¨‹åºèƒ½å¤Ÿèµ°å¾—æ›´è¿œï¼</text>
        
        <!-- æ·»åŠ åº•éƒ¨å¹¿å‘Šç»„ä»¶ -->
        <view class="ad-container">
          <ad-custom unit-id="adunit-ae4fa1490069ca56" bindload="adLoad" binderror="adError" bindclose="adClose"></ad-custom>
        </view>
      </view>
      
      <!-- æ·»åŠ åº•éƒ¨é—´è· -->
      <view style="height: 30rpx;"></view>
    </scroll-view>
  </view>

</view>