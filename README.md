# 中国历史地图小程序

这是一个基于微信小程序平台开发的中国历史地图应用，通过地图可视化展示中国历史各个时期的重要事件、地点和王朝疆域，并提供对应时期的世界历史事件对比。

## 功能特点

- **分时期展示**：支持从远古时期到新时代的中国历史分时期浏览
- **历史事件标记**：在地图上标记重要历史事件和地点，可点击查看详情
- **王朝疆域显示**：展示各个朝代的疆域范围，支持多政权多边形颜色区分（如三国、早期文明与起源）
- **时间轴导航**：主时间轴与子时间轴联动，直观展示历史时间线
- **世界史对比**：展示与中国各历史时期同期的世界历史事件
- **自定义信息浮窗**：优化的地图标记信息展示体验
- **全局搜索功能**：跨中国历史与世界历史的关键字搜索

## 近期开发进展（1.1.2 版本）

### 1. 早期文明与起源疆域多边形显示

- 支持"早期文明与起源"时期的多边形疆域显示，炎帝部落区域采用红橙色，黄帝部落区域采用黄色，视觉区分明显。
- 早期文明疆域数据结构与其他朝代保持一致，自动适配地图多边形格式。

### 2. 三国多政权多边形颜色区分

- 三国时期疆域支持多政权（蜀汉、曹魏、东吴）多边形并用不同颜色区分，提升历史地图的可读性和美观性。

### 3. 经纬度自动修正与健壮性提升

- 所有疆域数据和事件标记点的经纬度均自动验证和修正，彻底杜绝"LatLng.lng 取值应在 [-180, 180] 区间内"报错。
- 支持自动修正超界经纬度、无效点过滤，地图组件在任何时期都不会因数据异常导致崩溃。

### 4. 全局搜索体验优化

- 点击底部"搜索"按钮直接弹出大搜索面板，支持跨中国史与世界史的高亮搜索与跳转。
- 搜索结果高亮显示关键字，点击可自动切换到对应时期并高亮事件。

### 5. 现代史时期疆域数据精确化

- 厘清并修正了民国、抗战及新中国各阶段的疆域数据显示逻辑，确保各时期准确加载指定的疆域数据文件（例如，`nanjing_gov.js` 用于国府时期，`china.js` 用于抗战及之后），提升了历史疆域展示的准确性。

### 6. 其他优化

- 自定义地图信息浮窗样式与交互体验持续优化：
    - 移除了浮窗中冗余的"点击定位到地图标记"提示文本，使界面更简洁。
    - 调整了浮窗关闭按钮的样式，使其视觉上更柔和，与整体风格更协调。
- 主时间轴与子时间轴指示器联动逻辑完善。
- 代码结构持续重构，提升可维护性。

## 项目结构

```
historyLONG
  ├── data/           # 历史数据文件
  │   ├── borders/    # 王朝疆域GeoJSON数据
  │   ├── china_history.js # 中国历史事件数据
  │   └── world_history.js # 世界历史事件数据
  ├── pages/
  │   ├── index/      # 主页面文件
  │   ├── logs/       # 日志页面
  │   ├── tech_culture/ # 科技文化页面
  │   └── world_event_detail/ # 世界事件详情页面
  ├── utils/          # 工具函数
  ├── app.js          # 小程序主入口
  ├── app.json        # 小程序配置
  └── app.wxss        # 全局样式
```

## 数据管理

### 中国历史数据

- 所有中国历史事件数据整合在`data/china_history.js`文件中
- 每个历史事件包含ID、标题、位置名称、经纬度、详情描述、起止年份等信息
- 通过在`pages/index/index.js`中根据时期的年份范围进行筛选和处理

### 世界历史数据

- 世界史事件整理自教学资料并结构化存储在`data/world_history.js`文件中
- 按照与中国历史时期的时间重叠关系进行动态筛选显示
- 支持与中国历史事件的时间对比

### 王朝疆域数据

- 各时期疆域GeoJSON数据存于`data/borders/`目录下
- 通过解析转换为小程序地图组件支持的多边形格式显示

## 核心功能实现

### 自定义地图信息浮窗

采用自定义实现替代微信小程序自带的callout组件，解决了样式和兼容性问题：

- 使用绝对定位视图实现弹窗效果
- 通过状态变量控制中国历史事件和世界历史事件弹窗的显示优先级
- 支持事件标题、详情、起止年份显示

### 主时间轴与子时间轴

- **主时间轴**：横跨-2500年至2500年，500年为间隔的标尺
- **子时间轴**：展示当前选中历史时期的时间范围
- **事件指示器**：
  - 绿色指示器显示中国历史事件在时间轴上的位置
  - 橙色指示器显示世界历史事件在时间轴上的位置
  - 支持重叠显示效果

### 时期选择与面板

- 底部横向滚动按钮支持快速切换历史时期
- 中国史和世界史面板分别展示当前时期的历史事件列表
- 点击事件可联动显示时间轴指示器和详情弹窗

### 全局搜索功能

- 提供跨中国历史与世界历史数据的关键字搜索
- 搜索结果分类展示并支持点击跳转到对应历史时期和事件位置
- 匹配关键字以黄色背景高亮显示，提升信息辨识度
- 在1.1.2版本中完全优化了搜索入口，实现了更直观高效的搜索体验

## 使用说明

1. 使用微信开发者工具打开项目
2. 在模拟器中预览或编译上传
3. 通过底部时期按钮切换不同历史时期
4. 点击地图上的标记查看历史事件详情
5. 通过底部"搜索"按钮快速找到特定历史事件
6. 通过"世界史"按钮浏览对应时期的世界历史事件

## 技术特点

- 微信小程序原生开发，无需第三方框架
- 地图组件多边形与标记点自动坐标修正
- 高度定制化的UI与交互体验
- 结构化历史数据管理，易于扩展

---

**当前版本：1.1.2**

- 重点优化：疆域多边形显示、三国多政权颜色、经纬度健壮性、全局搜索体验

---

如需了解详细开发日志和历史版本说明，请查阅项目内注释和代码变更记录。

## 历史修订记录（Changelog）

- **1.1.2**
  - **早期文明疆域优化**：支持"早期文明与起源"时期的多边形疆域显示，区分炎帝与黄帝部落颜色。
  - **三国疆域颜色区分**：实现三国时期蜀汉、曹魏、东吴疆域的多边形颜色区分。
  - **经纬度健壮性提升**：全面自动验证和修正疆域及事件标记点的经纬度，防止地图组件因数据异常崩溃。
  - **全局搜索体验升级**：优化搜索入口，点击底部"搜索"按钮直接弹出大搜索面板；搜索结果高亮关键字，并支持点击跳转。
  - **现代史疆域精确化**：精确化民国、抗战及新中国各阶段的疆域数据显示逻辑。
  - **其他优化**：包括自定义地图信息浮窗样式调整、主子时间轴指示器逻辑完善、代码结构重构等。

- **1.1.1**
  - 新增全局搜索功能，支持中国史与世界史关键字检索
  - 优化地图标记点与浮窗交互体验
  - 修复部分时期疆域数据加载异常问题
  - 增强主/子时间轴联动逻辑

- **1.1.0**
  - 支持中国历史各时期的地图浏览与事件详情弹窗
  - 增加世界历史事件对比面板
  - 完善王朝疆域多边形显示与切换
  - 优化数据结构与加载性能

- **1.0.x**
  - 项目初始化，完成基础地图、时间轴、历史事件标记点等核心功能
  - 初步实现中国史分时期浏览与事件详情展示